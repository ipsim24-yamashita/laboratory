<!doctype html>
<html lang="ja">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
<title>GENESIS 解答ビューア（スクロールなし／1本指）</title>
<style>
  :root { --thumb-h: 92px; --gap: 10px; --bg:#0b1220; --panel:#0f172a; --accent:#22c55e; }

  /* 全画面アプリ。ページスクロールの概念を消す */
  html, body { height:100%; margin:0; overflow:hidden; background:var(--panel); color:#e5e7eb; font-family: system-ui, -apple-system, "Noto Sans JP", sans-serif; }

  .app { height:100dvh; display:grid; grid-template-rows:auto 1fr; }

  /* ===== カルーセル（前と同じ帯。固定） ===== */
  .carousel { position:relative; padding:8px 48px; background:var(--bg); border-bottom:1px solid rgba(255,255,255,.06); user-select:none; }
  .strip { display:flex; gap:var(--gap); overflow:hidden; }
  .thumb { height:var(--thumb-h); aspect-ratio:3/4; flex:0 0 auto; border-radius:10px; overflow:hidden; border:2px solid transparent; background:#111827; cursor:pointer; }
  .thumb img { width:100%; height:100%; object-fit:cover; display:block; }
  .thumb[aria-current="true"] { border-color: var(--accent); box-shadow: 0 0 0 2px rgba(34,197,94,.25); }
  .navBtn { position:absolute; inset-block:0; margin-block:auto; height:44px; width:44px; border-radius:50%; border:1px solid rgba(255,255,255,.15); background:rgba(15,23,42,.85); display:grid; place-items:center; cursor:pointer; }
  .navPrev{ left:6px } .navNext{ right:6px }

  /* ===== ビューア（表示中の画像のみ操作） ===== */
  .viewer { position:relative; background:var(--panel); touch-action:none; /* 標準ジェスチャ無効 */ }
  /* 2行レイアウト：上にツール、下に画像キャンバス。高さは残り全て */
  .viewer-inner { position:absolute; inset:0; display:grid; grid-template-rows:auto 1fr; }

  /* 画像上側・左揃えのツール */
  .tools { display:flex; gap:8px; flex-wrap:wrap; align-items:center; padding:10px 12px; }
  .tools .filename { font-weight:600; color:#cbd5e1; margin-right:4px; }
  .tools a { font-size:.9rem; text-decoration:none; color:#111; padding:6px 10px; border:1px solid #e5e7eb; border-radius:8px; background:#fafafa; }

  /* 実際に画像を描画するキャンバス領域 */
  .stage { position:relative; overflow:hidden; margin:0 12px 12px 12px; border:1px solid rgba(255,255,255,.08); border-radius:12px; background:#0b1220; }
  .stage img { display:block; width:100%; height:auto; transform-origin:0 0; will-change:transform; user-select:none; -webkit-user-drag:none; pointer-events:none; }

  .badge { position:absolute; right:10px; bottom:10px; background:rgba(0,0,0,.55); border:1px solid rgba(255,255,255,.12); padding:4px 8px; border-radius:8px; font-size:12px; }
</style>
</head>
<body>
  <div class="app">
    <!-- ===== 固定カルーセル ===== -->
    <div class="carousel" aria-label="ページ カルーセル">
      <button class="navBtn navPrev" aria-label="サムネを左へ">❮</button>
      <div class="strip" id="strip" role="listbox" aria-label="ページ一覧"></div>
      <button class="navBtn navNext" aria-label="サムネを右へ">❯</button>
    </div>

    <!-- ===== ビューア（スクロールなし・画像のみ操作） ===== -->
    <div class="viewer" id="viewer">
      <div class="viewer-inner">
        <div class="tools" id="tools">
          <span class="filename" id="fname">表示ページ</span>
          <a id="btn-dl" href="#" download>画像をダウンロード</a>
          <a id="btn-open" href="#" target="_blank" rel="noopener">原寸で開く</a>
        </div>
        <figure class="stage" id="stage"><img id="page" alt="表示ページ" src=""></figure>
        <div class="badge" id="badge">1.00×</div>
      </div>
    </div>
  </div>

<script>
(() => {
  /* ===== 画像リスト（あなたの方式） ===== */
  const BASE = "docs/";
  const groups = [
    { prefix: "1-", start: 1, end: 15 },
    { prefix: "2-", start: 1, end: 12 },
    { prefix: "3-", start: 1, end: 11 },
  ];
  const pad3 = n => String(n).padStart(3,"0");
  // ファイル名（拡張子込み）の配列
  const files = groups.flatMap(g =>
    Array.from({ length: g.end - g.start + 1 }, (_, i) =>
      `${g.prefix}${pad3(g.start + i)}.jpeg`
    )
  );

  /* ===== 要素 ===== */
  const strip = document.getElementById('strip');
  const viewer = document.getElementById('viewer');
  const stage  = document.getElementById('stage');
  const imgEl  = document.getElementById('page');
  const badge  = document.getElementById('badge');
  const fname  = document.getElementById('fname');
  const btnDL  = document.getElementById('btn-dl');
  const btnOPEN= document.getElementById('btn-open');
  const btnPrev= document.querySelector('.navPrev');
  const btnNext= document.querySelector('.navNext');

  /* ===== 状態 ===== */
  let current = 0;          // 現在のページIndex
  let scale = 1, tx = 0, ty = 0;
  let naturalW=0, naturalH=0;
  let activePointers = new Set();
  let dragging = false;
  let lastPointer = {x:0,y:0};
  let lastTapTime = 0;
  const DOUBLE_TAP_MS = 280;
  const ZOOM_IN = 2, MIN=1, MAX=2;

  /* ===== サムネ生成（カルーセルは以前と同じ見た目） ===== */
  function renderStrip(){
    strip.innerHTML = '';
    files.forEach((name, i) => {
      const b = document.createElement('button');
      b.className = 'thumb'; b.setAttribute('role','option');
      if (i===current) b.setAttribute('aria-current','true');
      const im = document.createElement('img');
      im.loading='lazy'; im.src = BASE + encodeURIComponent(name);
      b.appendChild(im);
      b.addEventListener('click', () => go(i));
      strip.appendChild(b);
    });
  }
  function markActive(){
    strip.querySelectorAll('.thumb').forEach((t, i) => {
      if (i===current) t.setAttribute('aria-current','true'); else t.removeAttribute('aria-current');
    });
  }

  /* ===== ページ切り替え ===== */
  function go(i){
    current = Math.max(0, Math.min(files.length-1, i));
    const url = BASE + encodeURIComponent(files[current]);
    imgEl.src = url;
    fname.textContent = `${current+1}. ${files[current]}`;
    btnDL.href = url; btnOPEN.href = url;
    resetFit();
    markActive();
    ensureThumbVisible();
  }

  /* ===== レイアウト／ズーム ===== */
  function resetFit(){ scale=1; tx=0; ty=0; applyTransform(); }
  function applyTransform(){ imgEl.style.transform = `translate(${tx}px,${ty}px) scale(${scale})`; badge.textContent = `${scale.toFixed(2)}×`; }

  function baseRenderSize(){
    const vw = stage.clientWidth;
    const ar = naturalH / naturalW;
    return { baseW: vw, baseH: vw * ar }; // 横幅フィット
  }
  function clampTranslate(){
    const { baseW, baseH } = baseRenderSize();
    const dispW = baseW * scale, dispH = baseH * scale;
    const vw = stage.clientWidth, vh = stage.clientHeight;
    const minX = Math.min(0, vw - dispW), maxX = 0;
    const minY = Math.min(0, vh - dispH), maxY = 0;
    tx = Math.max(minX, Math.min(maxX, tx));
    ty = Math.max(minY, Math.min(maxY, ty));
  }
  function zoomAround(pointX, pointY, next){
    next = Math.max(MIN, Math.min(MAX, next));
    const r = stage.getBoundingClientRect();
    const px = pointX - r.left, py = pointY - r.top;
    const k = next / scale;
    tx = px - (px - tx) * k;
    ty = py - (py - ty) * k;
    scale = next; clampTranslate(); applyTransform();
  }

  /* ===== 1本指のみの操作（ダブルタップで2倍→戻す、ドラッグでパン） ===== */
  viewer.addEventListener('pointerdown', (e) => {
    activePointers.add(e.pointerId);
    if (activePointers.size >= 2) { e.preventDefault(); return; } // 2本以上は無効
    const now = Date.now();
    if (now - lastTapTime < DOUBLE_TAP_MS) {
      zoomAround(e.clientX, e.clientY, scale === 1 ? ZOOM_IN : 1);
      lastTapTime = 0;
      e.preventDefault(); return;
    }
    lastTapTime = now;
    dragging = true;
    lastPointer.x = e.clientX; lastPointer.y = e.clientY;
    e.preventDefault();
  }, { passive:false });

  window.addEventListener('pointermove', (e) => {
    if (!dragging || activePointers.size !== 1) return;
    const dx = e.clientX - lastPointer.x;
    const dy = e.clientY - lastPointer.y;
    lastPointer.x = e.clientX; lastPointer.y = e.clientY;
    if (scale > 1) {
      tx += dx; ty += dy; clampTranslate(); applyTransform();
    }
    e.preventDefault();
  }, { passive:false });

  window.addEventListener('pointerup', (e) => {
    activePointers.delete(e.pointerId); dragging = false; e.preventDefault();
  }, { passive:false });

  viewer.addEventListener('wheel', (e) => {
    // トラックパッドのスクロールも禁止（1本指のみ仕様）
    e.preventDefault();
  }, { passive:false });

  imgEl.addEventListener('load', () => {
    naturalW = imgEl.naturalWidth; naturalH = imgEl.naturalHeight;
    resetFit();
  });

  window.addEventListener('resize', () => { clampTranslate(); applyTransform(); ensureThumbWindow(); });

  /* ===== カルーセル左右（表示ウィンドウをページング） ===== */
  let stripStart = 0;
  const GAP = () => parseInt(getComputedStyle(document.documentElement).getPropertyValue('--gap')) || 10;
  const thumbW = () => Math.round((parseInt(getComputedStyle(document.documentElement).getPropertyValue('--thumb-h')) || 92) * 0.75) + GAP();

  function visibleCount(){ return Math.max(1, Math.floor((viewer.clientWidth - 96) / thumbW())); }
  function ensureThumbWindow(){
    const count = visibleCount();
    const maxStart = Math.max(0, files.length - count);
    stripStart = Math.max(0, Math.min(stripStart, maxStart));
    strip.querySelectorAll('.thumb').forEach((t, i) => {
      t.style.display = (i >= stripStart && i < stripStart + count) ? '' : 'none';
    });
  }
  function ensureThumbVisible(){
    const count = visibleCount();
    if (current < stripStart) { stripStart = current; ensureThumbWindow(); }
    else if (current >= stripStart + count) { stripStart = current - count + 1; ensureThumbWindow(); }
  }
  document.querySelector('.navPrev').addEventListener('click', () => { stripStart = Math.max(0, stripStart - visibleCount()); ensureThumbWindow(); });
  document.querySelector('.navNext').addEventListener('click', () => { stripStart = Math.min(Math.max(0, files.length - visibleCount()), stripStart + visibleCount()); ensureThumbWindow(); });

  /* ===== 初期化 ===== */
  function init(){
    renderStrip();
    ensureThumbWindow();
    go(0); // 初期値：横幅フィットで 1-001.jpeg を表示
  }
  init();
})();
</script>
</body>
</html>
